<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <style>
    #background {
      background-image: url("assets/background.jpg");
      background-size: cover;
      position: absolute;
      left: 50px;
      top: 50px;
      width: 500px;
      height: 500px;
      border: 1px solid black;
    }

    #player {
      position: absolute;
      left: 30px;
      bottom: 80px;
    }

    .enemy {
      position: absolute;
      right: 10px;
      bottom: 100px;
    }
  </style>

  <script>
      const playerWidth = 50;
      const playerHeight = 50;

      let enemyRight = 10;

      let isJumping = false;
      let isSpawning = false;

      function jump() {
          if (isJumping === true) {
              return;
          }

          isJumping = true;
          $("#player").animate({
              bottom: "+=150px"
          }, 500).animate({
              bottom: "-=150px"
          }, 500, () => {
              isJumping = false;
          });
      }

      function moveEnemy() {
          $(".enemy").css("right", "+=10px");

          checkEnemyBounds();
      }

      function checkEnemyBounds() {
          const player = $(".enemy");
          const playerLeft = parseInt(player.css("left"));  // "0px" -> 0

          if (playerLeft < -100) {
              respawnEnemy();
          }
      }

      function respawnEnemy() {
          if (isSpawning) {
              return;
          }

          isSpawning = true;
          setTimeout(() => {
              $(".enemy").css("right", "-100px");
              isSpawning = false;
          }, 1000);
      }

      function checkGameOver() {
          const player = document.getElementById("player");
          const enemy = document.getElementById("enemy");

          let isGameOver = false;

          if (checkCollision(player, enemy)) {
              console.log("Game Over");
              isGameOver = true;
          }

          return isGameOver;
      }

      function checkCollision(div1, div2) {
          // div1과 div2의 위치와 크기를 구합니다.
          const rect1 = div1.getBoundingClientRect();
          const rect2 = div2.getBoundingClientRect();

          // 충돌 체크 (겹침)
          const isColliding = !(rect1.right < rect2.left ||   // div1의 오른쪽 끝이 div2의 왼쪽 끝보다 왼쪽에 있을 때
              rect1.left > rect2.right ||   // div1의 왼쪽 끝이 div2의 오른쪽 끝보다 오른쪽에 있을 때
              rect1.bottom < rect2.top ||   // div1의 아래쪽 끝이 div2의 위쪽 끝보다 위에 있을 때
              rect1.top > rect2.bottom);    // div1의 위쪽 끝이 div2의 아래쪽 끝보다 아래에 있을 때

          return isColliding;
      }


      function gameLoop() {
          moveEnemy();

          if (checkGameOver()) {
            return;
          }

          requestAnimationFrame(gameLoop);
      }

      document.addEventListener("keydown", (event) => {
          if (event.key === " ") {
              jump();
          }
      });

      $(() => {
          gameLoop();
      })
  </script>

</head>
<body>
<div id="background">
  <div id="player">
    <img src="assets/mario.png" width="50px" height="50px">
  </div>

  <div class="enemy" id="enemy">
    <img src="assets/enemy.png" width="100px">
  </div>
</div>
</body>
</html>